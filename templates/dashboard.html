{% extends "base.html" %}

{% block title %}Dashboard - Shepherd CMS{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div>
            <h1>Configuration Dashboard</h1>
            <p>View and manage all configurations</p>
        </div>
        {% if g.user and g.user.role in ['editor', 'admin'] %}
        <div class="header-actions">
            <a href="{{ url_for('create_config_ui') }}" class="primary">
                âž• Create New Configuration
            </a>
        </div>
        {% endif %}
    </div>
</div>

{% if error %}
<div class="alert alert-error">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert {% if category == 'error' %}alert-error{% else %}alert-success{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

{% if configs and configs|length > 0 %}
<div class="table-container">
    <table role="table">
        <thead>
            <tr>
                <th>Config ID</th>
                <th>App Name</th>
                <th>Environment</th>
                <th>Latest Version</th>
                <th>Created At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for config in configs %}
            <tr>
                <td>
                    <strong>{{ config.config_id }}</strong>
                </td>
                <td>{{ config.app_name }}</td>
                <td>{{ config.environment }}</td>
                <td>
                    <span class="version-badge">v{{ config.version }}</span>
                </td>
                <td>{{ config.created_at[:10] }}</td>
                <td>
                    <div class="actions">
                        <a href="/config/{{ config.config_id }}" role="button" class="secondary">View Details</a>
                        <a href="/edit/{{ config.config_id }}" role="button">Edit</a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 2rem;">
    <p><strong>{{ configs|length }}</strong> configuration(s) found</p>
</div>

{% else %}
<div class="empty-state" style="text-align: center; padding: 3rem 0;">
    <h2>No configurations found</h2>
    <p>Create your first configuration using the web interface or API.</p>
    
    {% if g.user and g.user.role in ['editor', 'admin'] %}
    <div style="margin-top: 1.5rem;">
        <a href="{{ url_for('create_config_ui') }}" role="button" class="primary">
            Create Configuration
        </a>
    </div>
    {% endif %}
    
    <details style="margin-top: 2rem; text-align: left;">
        <summary>Example API Usage</summary>
        <div class="json-code" style="margin-top: 1rem;">
curl -X POST http://localhost:5000/api/config \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "config_id": "my_app_config",
    "app_name": "MyApp",
    "environment": "development",
    "settings": {
      "database_url": "mongodb://localhost:27017/myapp",
      "debug": true,
      "max_connections": 100
    },
    "change_notes": "Initial configuration setup"
  }'
        </div>
        <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--secondary-color);">
            Or use the Create Configuration button above for a user-friendly form.
        </p>
    </details>
    
    <div style="margin-top: 1.5rem;">
        <a href="/api/health" role="button" class="secondary">Check API Health</a>
    </div>
</div>
{% endif %}

<div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e2e8f0;">
    <h3>Quick Actions</h3>
    <div class="actions">
        {% if g.user and g.user.role in ['editor', 'admin'] %}
        <a href="{{ url_for('create_config_ui') }}" role="button" class="primary outline">Create Configuration</a>
        {% endif %}
        <a href="/api/health" role="button" class="secondary">API Health Check</a>
        <a href="#" onclick="location.reload()" role="button" class="secondary">Refresh Dashboard</a>
    </div>
</div>

<style>
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 2rem;
    }
    
    .header-actions {
        flex-shrink: 0;
    }
    
    .header-actions a {
        white-space: nowrap;
    }
    
    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            gap: 1rem;
        }
        
        .header-actions {
            width: 100%;
        }
        
        .header-actions a {
            width: 100%;
            text-align: center;
        }
    }
</style>
{% endblock %}